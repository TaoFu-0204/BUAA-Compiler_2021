# 中间代码设计

## 设计思想

希望实现SSA

## IR列表

### 算术指令（允许立即数）

| 指令                          | 用途      |
| ----------------------------- | --------- |
|add \<dest\> \<op1\> \<op2\>| op1 + op2|
|minu \<dest\> \<op1\> \<op2\>| op1 - op2|
|mult \<dest\> \<op1\> \<op2\>|op1 * op2|
|div \<dest\> \<op1\> \<op2\>| op1 / op2（整除）|
|assign  \<dest\> \<op1\>| dest = op1（赋值） |
|lshift \<dest\> \<op1\> \<op2\>|op1 << op2|
|rshift \<dest\> \<op1\> \<op2\>|op1 >> op2|

### 逻辑指令

| 指令                          | 用途      |
| ----------------------------- | --------- |
| gre  \<dest\> \<op1\> \<op2\> | op1 > op2 |
|geq  \<dest\> \<op1\> \<op2\>| op1 >= op2 |
|lss  \<dest\> \<op1\> \<op2\>|op1 < op2|
|leq  \<dest\> \<op1\> \<op2\>| op1 <= op2|
|eql  \<dest\> \<op1\> \<op2\>| op1 == op2|
|neq  \<dest\> \<op1\> \<op2\>| op1 != op2|

### 控制流

| 指令                          | 用途      |
| ----------------------------- | --------- |
| br \<label\> | 无条件跳转至 \<label\>（op3） |
| bz \<label\> \<op1\>| 若op1为0则跳转至\<label\>（op3） |
|call \<name\> \<ParamList\>|函数调用（op3），带参数列表（可空）|
|ret \<op3\>|函数返回，带返回值op3（可以没有）|
|exit|main函数结束，程序结束|

### 内存操作

| 指令                          | 用途      |
| ----------------------------- | --------- |
|load \<op3\> \<op1\> \<op2\>|从op1为基地址，op2为偏移量处取值送op3|
|store \<op3\> \<op1\> \<op2\>|向op1为基地址，op2为偏移量处存op3|
|alloca \<dest\> \<op1\>|开辟op1字节大小空间，基地址送dest（int需*4）|

### 输入输出

| 指令                          | 用途      |
| ----------------------------- | --------- |
|getint \<dest\>|dest=getint()|
|print \<strdest\> \<ParamList\>|printf，带字符串地址（op3）和参数列表|

### 其他

| 指令                          | 用途      |
| ----------------------------- | --------- |
| #\<id\> | 中间变量，编号为id |
|func \<name\> \<paramlist\> {}| 函数定义（op3），带参数列表 |
|label \<LabelName\>|标签（op3）|